<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <title>Bookmark</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://vlee.fun/data/js/enc.js"></script>
</head>
<body style="width: 960px;margin: 0 auto;">
    <div id="html"></div>
    <div style="padding: 10px;border-top: 2px solid #FF7800;">
        <input type="file" id="upfile" /><span id="return"></span>
    </div>
    <script>
		var pwd = document.cookie;
		if (pwd == '') {
			var person = window.prompt("请输入解密密码", "");
			if (person != null) {
				document.cookie = person + "; secure=true; path=/";
				pwd = document.cookie;
			}
		}

        function get() {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.open('GET', 'https://data.daxiyun.workers.dev/data/bookmark');
			xmlhttp.send();
			xmlhttp.onload = function() {
                document.getElementById("html").innerHTML = sm4(xmlhttp.response, pwd, 'de');
			}
        }
        
        document.getElementById("upfile").onchange = function() {
			var reader = new FileReader(); //这是核心,读取操作就是由它完成.
            reader.readAsText(document.getElementById("upfile").files[0]); //读取文件的内容,也可以读取文件的URL
            reader.onload = function () {
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open('PUT', 'https://data.daxiyun.workers.dev/data/bookmark');
				xmlhttp.setRequestHeader("Authorization", sm3(pwd));
				xmlhttp.send(sm4(this.result, pwd, 'en'));
				xmlhttp.onload = function() {
					var ReturnData = xmlhttp.response;
					if (ReturnData == 'ok') {
						document.getElementById('return').innerHTML = '上传成功。';
						get();
					}
				}
            }
        }
        
        get();
    </script>
</body>
</html>
