<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <title>上传文件</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://vlee.fun/data/enc.js"></script>
</head>
<body style="width: 960px;margin: 0 auto;">
    <div id="html"></div>
    <div style="padding: 10px;border-top: 2px solid #FF7800;">
        <input type="file" id="upfile" />
	<p><span id="return"></span></p>
    </div>
    <script>
		var pwd = document.cookie;
		if (pwd == '') {
			var person = window.prompt("请输入解密密码", "");
			if (person != null) {
				document.cookie = person + "; secure=true; path=/";
				pwd = document.cookie;
			}
		}
		
		document.getElementById("upfile").onchange = function() {
			var file = document.getElementById("upfile").files[0];
			var name = file.name;
			var url = 'https://data.yunbin.xyz/files/' + name;
			var reader = new FileReader(); //这是核心,读取操作就是由它完成.
			reader.readAsArrayBuffer(file); //读取文件的内容,也可以读取文件的URL
			reader.onload = function() {
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open('PUT', url);
				xmlhttp.setRequestHeader("Authorization", sm3(pwd));
				xmlhttp.send(this.result);
				xmlhttp.onload = function() {
					document.getElementById('return').innerHTML = '上传成功 <a href="'+url+'" target="_blank">'+url+'</a>';
				}
			}
		}
    </script>
</body>
</html>
