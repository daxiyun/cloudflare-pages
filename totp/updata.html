<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <title>Github API</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://nan.pages.dev/js/enc.js"></script>
</head>
<body>
    <textarea id="data" style="height:180px;width:500px;"></textarea>
    <br>
    <button type="button" onclick="update()">上传更新</button>
    <button type="button" onclick="get()">拉取最新</button>
    <span id="return"></span>
    <script>
		var pwd = document.cookie;
		if (pwd == '') {
			var person = window.prompt("请输入解密密码", "");
			if (person != null) {
				document.cookie = person + "; secure=true; path=/";
				pwd = document.cookie;
			}
		}

        function get() {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.open('GET', 'https://data.daxiyun.workers.dev/data/totp');
			xmlhttp.send();
			xmlhttp.onload = function() {
                document.getElementById("data").value = sm4(xmlhttp.response, pwd, 'de');
			}
        }
        
        function update() {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.open('PUT', 'https://data.daxiyun.workers.dev/data/totp');
			xmlhttp.setRequestHeader("Authorization", sm3(pwd));
			xmlhttp.send(sm4(document.getElementById("data").value, pwd, 'en'));
			xmlhttp.onload = function() {
				var ReturnData = xmlhttp.response;
				if (ReturnData == 'ok') {
					document.getElementById('return').innerHTML = '上传成功。';
					get();
				}
			}
        }

        get();
    </script>
</body>
</html>
